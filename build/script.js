"use strict";var app=angular.module("myApp",[]);
app.controller("shoppingController",["$scope","$http","$window",function(t,o,n){t.months=[1,2,3,4,5,6,7,8,9,10,11,12],t.years=[2014,2015,2016,2017,2018,2019,2020],t.content="/static/products.html",t.setContent=function(o){t.content="/static/"+o},t.setProduct=function(o){t.product=this.product,t.content="/static/product.html"}}]);
function BaseConnector(e){}function getConnector(e,o){Interface.ensureImplements(e,absConnector),this.myConnector=e}function createInjector(){function e(e,o){t[e]=o}function o(e,o){i[e]=o}function n(e,n){o(e,function(){var e=Object.create(n.prototype);return s(n,e),e})}function s(){var e,o,n,r=[];"string"==typeof arguments[0]?(e=arguments[1],o=arguments[0].replace(/ /g,"").split(","),n=arguments[2]||{}):(e=arguments[0],o=e.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].replace(/ /g,"").split(","),n=arguments[1]||{});var r=o.map(function(e){if(t.hasOwnProperty(e))return t[e];if(i.hasOwnProperty(e)){var o=i[e],n=s(o);return t[e]=n,n}});return e.apply(n||{},r)}var t={},i={};return{value:e,factory:o,service:n,invoke:s}}var interface=require("./interface.js"),async=require("async"),abstractConnector=new interface.Interface("AbstractConnector",["connect","disconnect","create","update","delete","getNextSeq","find","loadAutoParams","saveAutoParams","loadAutoTable","getParameter","saveParameter","findAndUpdate"]);BaseConnector.prototype={loadAutoTable:function(e,o){var n=this,s="0",t=(e.length,[]);for(p in e){console.log("** "+p+" val "+e[p]);var i=p.split("___");if(i.length>1){var r={};i[1]&&""!=i[1]&&(r[i[1]]=e[p]),console.log("table::"+i[0]+"__SessionId::"+s+"params="+i[1]+"upd="+JSON.stringify(r)),function(o){t.push(new Promise(function(s,t){n.connector.find(i[0],r,!0,function(n,i){if(n)t(n);else{var r={};for(q in i)r[q]=i[q];console.log("err::"+n+"p::"+o+" val::"+JSON.stringify(r)),e[o]=r,s(r)}})}))}(p)}}Promise.all(t).then(function(n){o&&o(e.__SessionId)}).catch(function(e){console.log("promise error"+e)})},loadAutoParams:function(e,o){console.log("inside loadAutoParams:"),this.connector.find(this.connector,{__SessionId:e.__SessionId},function(n,s){if(n)console.log("loadAutoParams:error"+n);else{console.log("loadAutoParams:success"+JSON.stringify(s));for(var t=0,i=0;t<s.length;t++)console.log("Key:"+s[t].key+"Value:"+s[t].value),null==s[t].subKey||""==s[t].subKey||void 0==s[t].subKey?(e[s[t].key]=s[t].value,i=0):(e[s[t].key][s[t].subKey][i]=s[t].value,i++)}BaseConnector.prototype.loadAutoTable(e,o)})},saveAutoParams:function(e,o){var n=this,s="0";n.callback=o,n.connector.findSessionParam(n.connector,{__SessionId:e.__SessionId},function(o,t){s=t.__SessionId,o||""==t.__SessionId||void 0==t.__SessionId?(console.log("saveAutoParams::NULL"),n.connector.getNextSeq("__SessionId",function(o,t){s=t.seq,o||(console.log("saveAutoParams::NULL"+t.seq),e.__SessionId=t.seq,BaseConnector.prototype.saveParamsForValidSessionId(t.seq,e,n.callback))})):(console.log("saveAutoParams::"+t.__SessionId),e.__SessionId=t.__SessionId,BaseConnector.prototype.saveParamsForValidSessionId(t.__SessionId,e,n.callback))})},saveParamsForValidSessionId:function(e,o,n){var s,t,i=this;console.log("saveTableSessId::"+e+" params::"+JSON.stringify(o)),o.__SessionId=e;var r=[],a=function(e,o){r.push(new Promise(function(n,s){console.log("Query="+JSON.stringify(e)+" Update="+JSON.stringify(o)),i.connector.update(c[0],e,o,!0,function(e,o){e?s(e):n(o)})}))};for(s in o){var c=s.split("___");if(c.length>1)if(console.log("table::"+c[0]+"__SessionId::"+e+"params="+c[1]),o[s][0]){console.log("param::array ="+JSON.stringify(o[s]));for(t in o[s]){var l={},u={};console.log("param::idx"+t+" ="+JSON.stringify(o[s][t])),o[s][t]._id?l._id=o[s][t]._id:l=o[s][t],u=o[s][t],function(e,o){a(e,o)}(l,u)}}else{console.log("param::no idx"+JSON.stringify(o[s][0]));var l={},u={};o[s]._id?l._id=o[s]._id:l=o[s],u=o[s],function(e,o){a(e,o)}(l,u)}else console.log("** "+s+" val "+o[s]),function(e,o){a(e,o)}({__SessionId:e,key:s},{__SessionId:e,key:s,value:o[s]})}Promise.all(r).then(function(e){console.log("savetable promises success"+JSON.stringify(e)),n&&n(o.__SessionId)}).catch(function(e){console.log("savetable promise error"+e+"::"+JSON.stringify(r[0])),n&&n(o.__SessionId)})},saveAutoTable:function(e,o){var n=this,s="0";n.callback=o,n.connector.findSessionParam(n.connector,{__SessionId:e.__SessionId},function(o,t){s=t.__SessionId,o||""==t.__SessionId||void 0==t.__SessionId?(console.log("saveAutoTable::NULL"),n.connector.getNextSeq("__SessionId",function(o,t){s=t.seq,o||(console.log("saveAutoTable::NULL"+t.seq),e.__SessionId=t.seq,BaseConnector.prototype.saveParamsForValidSessionId(t.seq,e,n.callback))})):(console.log("saveAutoTable::"+t.__SessionId),e.__SessionId=t.__SessionId,BaseConnector.prototype.saveParamsForValidSessionId(t.__SessionId,e,n.callback))})},getParameter:function(e,o,n,s){var t={__SessionId:e};null!==o&&""!==o&&(t.key=o),null!==n&&""!==n&&(t.subKey=n),console.log("getParameter:"+arguments[1]+":"+JSON.stringify(t)),this.connector.findSessionParam(this.connector,t,function(t,i){console.log("getParameter::0:"+o+":"+n+": "+e+":err "+t+":res "+JSON.stringify(i)),s(t,i)})},saveParameter:function(e,o,n,s,t){this.connector.update(this.connector,{__SessionId:e,key:o,subKey:n},{__SessionId:e,key:o,subKey:n,value:s},function(e,o){console.log("saveParameter:"+JSON.stringify(e)+"resp:"+JSON.stringify(o)),t()})}},MongoConnector=function(e,o){var n,s,t,i,r;n=s=t=i=r={a:"A"},this.mongoose=o,this.server=e,n=this.mongoose.Schema,s=new n({_id:String,seq:Number}),t=new n({__SessionId:{type:Number,index:1,required:!0},key:{type:String,required:!0},subKey:{type:String},rowId:{type:Number},value:{type:String}}),i=this.mongoose.model("counters",s),r=this.mongoose.model("sessionparameters",t),this.connector=this,MongoConnector.superclass.connector=this,this.mongoose.connection.on("error",function(o){console.error("Failed to connect to DB "+e+" on startup ",o)}),this.mongoose.connection.on("disconnected",function(){console.log("Mongoose default connection to DB :"+e+" disconnected")});var a=function(){var o=require("mongoose");o.connection.close(function(){console.log("Mongoose default connection with DB :"+e+" is disconnected through app termination"),process.exit(0)})};process.on("SIGINT",a).on("SIGTERM",a),interface.Interface.ensureImplements(this,abstractConnector),this.getSessionParameterTable=function(){return r},this.getCounters=function(){return i}},interface.extend(MongoConnector,BaseConnector),MongoConnector.prototype={connect:function(){console.log("Connecting to Server: "+this.server),this.mongoose.connect(this.server)},disconnect:function(){this.mongoose.disconnect()},create:function(e,o,n){var s=new e(o);s.save(n)},updateDefault:function(e,o,n,s){var t=e.getSessionParameterTable().update(o,n);t.setOptions({upsert:!0,multi:!0}),t.exec(s)},update:function(e,o,n,s,t){if(arguments.length<=3)MongoConnector.prototype.updateDefault(arguments[0],arguments[1],arguments[2]);else{var i=this.mongoose.model(e);if(console.log("connection:update:0:"+JSON.stringify(o)+"upd"+JSON.stringify(n)),s){var o=i.update(o,n);o.setOptions({upsert:!0,multi:!0}),o.exec(t)}else{var o=i.findOne(o);o.exec(function(e,s){if(e)throw e;o=s.update(n),o.exec(t)})}}},findAndUpdate:function(e,o,n,s,t){var i=this.mongoose.model(e);if(console.log("connection:update:0:"+JSON.stringify(o)+"upd"+JSON.stringify(n)),s){var o=i.findOneAndUpdate(o,n,{new:!0,upsert:!0,multi:!0});o.exec(t)}else{var o=i.findOneAndUpdate(o,n,{new:!0,upsert:!0});o.exec(t)}},delete:function(e,o,n,s){var t=this.mongoose.model(e);if(n){var o=t.remove(o);o.exec(s)}else{var o=t.findOne(o);o.exec(function(e,n){if(e)throw e;o=n.remove(s)})}},findSessionParam:function(e,o,n){console.log("findSessionparam: "+JSON.stringify(o)),e.getSessionParameterTable().find(o,n)},findDefault:function(e,o,n){e.getSessionParameterTable().find(o,n)},find:function(e,o,n,s){if(arguments.length<=3)return void MongoConnector.prototype.findDefault(arguments[0],arguments[1],arguments[2]);var t=this.mongoose.model(e);n?(console.log("inside query::"+JSON.stringify(o)),t.find(o,s)):t.findOne(o,s)},getNextSeq:function(e,o){this.getCounters().findOneAndUpdate({_id:e},{$inc:{seq:1}},{upsert:!0,new:!0},o)},loadAutoParams:function(){MongoConnector.superclass.loadAutoParams.apply(this,arguments)},saveAutoParams:function(){MongoConnector.superclass.saveAutoParams.apply(this,arguments)},loadAutoTable:function(){MongoConnector.superclass.loadAutoTable.apply(this,arguments)},saveAutoTable:function(){MongoConnector.superclass.saveAutoTable.apply(this,arguments)},getParameter:function(){MongoConnector.superclass.getParameter.apply(this,arguments)},saveParameter:function(){MongoConnector.superclass.saveParameter.apply(this,arguments)}},exports.MongoDBConnector=MongoConnector;
"use strict";app.controller("myController",["$scope","$http","$filter",function(t,e,n){var o,r=[],a=function(e,n,a,s){console.log("/autoparams::"+JSON.stringify(e));var i={};for(i in e){console.log(i+"::"+e[i]);var c=i.split("___");""==e[i]||null==e[i]||void 0==e[i]?t.$parent[c[0]]=e[i]:"string"!=typeof e[i]||"{"!=e[i][0]&&"["!=e[i][0]&&'"'!=e[i][0]&&"'"!=e[i][0]?t.$parent[c[0]]=e[i]:t.$parent[c[0]]=JSON.parse(e[i])}o&&t[o].apply(t,r)},s=function(e,n,o,r){t.status=e},i=function(e){return new Promise(function(n,o){var r=document.querySelectorAll("div, input, p, ul, span, option, select, tr, textarea");angular.forEach(r,function(n){if(null!=n.attributes.getNamedItem("mdl-param")){console.log("Found="+n.attributes.getNamedItem("mdl-param")+": str="+n.attributes.getNamedItem("ng-model").value);var o=t[n.attributes.getNamedItem("ng-model").value];void 0===o?e[n.attributes.getNamedItem("mdl-param").value]="":e[n.attributes.getNamedItem("mdl-param").value]=o}}),n(e)})};t.pushData=function(t,n,c){o=c,r=Array.prototype.slice.call(arguments,3);var l={},u=i(l);u.then(function(i){console.log("promise success"),l.__EventName=n,console.log("inside pushData: "+JSON.stringify(l)+"callback:"+o+" Arguments:"+JSON.stringify(r)),""==t?e.post("/autoparams",JSON.stringify(l)).success(a).error(s):e.post(t,JSON.stringify(l)).success(a).error(s)})},t.popData=function(t){o=t;var n={},r=i(n);r.then(function(t){console.log("here: "+JSON.stringify(n)),e.post("/autoparams",n).success(a).error(s)})},t.execForeignEvent=function(n,o){t.pushData("/execevent",n,function(o){var r={function:n,__SessionId:o};e.post("/execevent",r).success(function(e,n,o,r){console.log("execForeignEvent:"+JSON.stringify(e));var a={};for(a in e)t[a]=e[a],console.log(a)}).error(function(e,n,o,r){t.status=e})})},t.execLocalEvent=function(t){call-t()}}]).directive("mdl-param",function(){return{scope:{"mdl-param":"@"},restrict:"A",transclude:!0,link:function(t,e,n,o){e.append(mdl-param)}}});
"use strict";
var express=require("express");module.exports=function(o,s){var n=function(o,s,n){var a=function(o,s){return o[s]};return o.split(s).reduce(a,n)};o.post("/autoparams",function(o,n){s.connect(),console.log(JSON.stringify(o.body)+" params:"+JSON.stringify(o.params));var a={};a=o.body,s.saveAutoParams(a,function(o){a.__SessionId=o,s.loadAutoParams(a,function(){console.log("After Load Params"+JSON.stringify(a)),n.json(a)})})}),o.post("/connect",function(o,s){console.log(o.body+" params:"+o.params);var n=o.body,a=global[n.function],e=n.__SessionId,t=a(e);s.json(t)}),o.post("/autoSaveData",function(o,n){console.log(JSON.stringify(o.body)+" params:"+JSON.stringify(o.params));var a=o.body;a.__SessionId;console.log("::"+global.testEvent+"&&"+a.__EventName+":::"+a.__SessionId),s.connect(),s.saveAutoTable(a,function(o){a.__SessionId=o,global._params=a,console.log("Params="+JSON.stringify(a)),n.json(a)})}),o.post("/autoLoadData",function(o,n){console.log(JSON.stringify(o.body)+" params:"+JSON.stringify(o.params));var a=o.body;a.__SessionId;console.log("::"+global.testEvent+"&&"+a.__EventName+":::"+a.__SessionId),s.connect(),s.loadAutoTable(a,function(o){a.__SessionId=o,global._params=a,console.log("Params="+JSON.stringify(a)),n.json(a)})}),o.post("/execevent",function(o,s){console.log(JSON.stringify(o.body)+"obj::"+o.body+" params:"+JSON.stringify(o.params));var a=JSON.parse(JSON.stringify(o.body)),e=a.__SessionId;console.log("::"+t+"&&"+a.__EventName+":::"+a.__SessionId);var t=n(a.__EventName,".",global);a.__SessionId=e,global._params=a;var r=a;console.log("Params="+JSON.stringify(a)),t(a,function(){s.json(r)})})};
var interface=function(e,t){if(console.log(e+":methods:"+t),2!=arguments.length)throw new Error("Interface constructor called with "+arguments.length+"arguments, but expected exactly 2.");this.name=e,this.methods=[];for(var o=0,r=t.length;o<r;o++){if("string"!=typeof t[o])throw new Error("Interface constructor expects method names to be passed in as a string.");this.methods.push(t[o])}};exports.Interface=interface,exports.Interface.ensureImplements=function(e){if(arguments.length<2)throw new Error("Function Interface.ensureImplements called with "+arguments.length+"arguments, but expected at least 2.");for(var t=1,o=arguments.length;t<o;t++){var r=arguments[t];if(console.log(r),r.constructor!==exports.Interface)throw new Error("Function Interface.ensureImplements expects argumentstwo and above to be instances of Interface.");for(var n=0,s=r.methods.length;n<s;n++){var c=r.methods[n];if(!e[c]||"function"!=typeof e[c])throw new Error("Function Interface.ensureImplements: object does not implement the "+r.name+" interface. Method "+c+" was not found.")}}},exports.extend=function(e,t){var o=function(){};o.prototype=t.prototype,e.prototype=new o,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)};
MyConnector=function(e){function t(){var t=require("./connector.js"),r=e.Schema,n=new r({_id:String,seq:Number,__SessionId:{type:Number,index:1,required:!0},name:{type:String,required:!0},description:{type:String},short:{type:String},fromDt:{type:Date},toDt:{type:Date},sku:{type:String},price:{type:Number},tax:{type:Number},status:{type:Number}},{collection:"product"}),o=(e.model("product",n),new r({_id:String,seq:Number,__SessionId:{type:Number,index:1,required:!0},category:{type:String,required:!0},description:{type:String}},{collection:"product_category"}));e.model("product_category",o);return new t.MongoDBConnector("mongodb://127.0.0.1/cartHosonto",e)}var r;return{getInstance:function(){return r||(r=t()),r}}},module.exports=MyConnector;
var models=function(e){Schema=e.Schema;var r=new Schema({name:String,address:String,city:String,state:String,zip:String},{_id:!1});e.model("Address",r);var i=new Schema({cardtype:{type:String,enum:["Visa","MasterCard","Amex"]},name:String,number:String,expiremonth:Number,expireyear:Number,address:[r]},{_id:!1});e.model("Billing",i);var t=new Schema({name:String,imagefile:String,description:String,price:Number,instock:Number});e.model("products",t);var n=new Schema({quantity:Number,product:[t]},{_id:!1});e.model("ProductQuantity",n);var a=new Schema({userid:String,items:[n],shipping:[r],billing:[i],status:{type:String,default:"Pending"},timestamp:{type:Date,default:Date.now}});e.model("orders",a);var m=new Schema({sessionId:{type:Number,index:1},userid:{type:String,unique:!0,required:!0},shipping:[r],billing:[i],cart:[n]});e.model("customer",m)};module.exports=models;
"use strict";var async=require("async"),myConnection,orderModule=function(o){myConnection=o};orderModule.addToCart=function(o,n){myConnection.connect(),myConnection.saveAutoParams(o,function(){myConnection.loadAutoParams(o,function(){console.log("product="+o.product+"customer="+o.customer___);var t=o.customer___[0];console.log("cust="+t+" cart="+JSON.stringify(t.cart));for(var e=!1,r=0;r<t.cart.length;r++){var c=t.cart[r],u=c.product[0],a=o.product;u._id==a._id&&(c.quantity+=1,e=!0)}e||t.cart.push({quantity:1,product:[o.product]}),console.log("cart=="+JSON.stringify(t.cart)),o.customer___=[t],myConnection.saveAutoParams(o,n)})})},orderModule.checkOut=function(o,n){myConnection.connect(),myConnection.saveAutoParams(o,function(){myConnection.loadAutoParams(o,n)})},orderModule.placeOrder=function(o,n){var t=require("mongoose"),e=t.model("customer"),r=t.model("orders");myConnection.connect(),myConnection.saveAutoTable(o,function(){var t=o.customer___[0],c=t.cart,u=t.shipping,a=t.billing,i=new r({userid:"customerA",items:c,shipping:u,billing:a});i.save(function(t,r){t?(o.__Error="Failed to save Order.",myConnection.loadAutoTable(o,n)):e.update({userid:"CustomerA"},{$set:{cart:[]}}).exec(function(t,e){t||e<1?o.__Error="Failed to update cart.":o.__Status="Order Successfully Saved.",myConnection.loadAutoTable(o,n)})})})},module.exports=orderModule;
app.controller("shoppingController",["$scope","$http","$window",function(t,o,n){t.months=[1,2,3,4,5,6,7,8,9,10,11,12],t.years=[2014,2015,2016,2017,2018,2019,2020],t.content="/static/products.html",t.setContent=function(o){t.content="/static/"+o},t.setProduct=function(o){t.product=this.product,t.content="/static/product.html"}}]);